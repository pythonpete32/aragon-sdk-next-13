# Aragon SDK + NextJS 13

This project is a basic demo using the [aragonOSx SDK](https://github.com/aragon/sdk).

## Stack

- [Next Js 13](https://nextjs.org/)
- [Typescript](https://www.typescriptlang.org/)
- [Aragon SDK](https://github.com/aragon/sdk)
- [RainbowKit](https://www.rainbowkit.com/)
- [Viem](https://viem.sh/)
- [Wagmi](https://wagmi.sh/)

## Setup

1. Bootstrap the project by using Create React App with pnpm and choose the defaults

```bash
npx create-next-app@latest --use-pnpm
```

2. Install Rainbowkit, Wagmi, and viem to bootstrap connecting to the blockchain

```bash
pnpm install @rainbow-me/rainbowkit wagmi viem && pnpm install -D pino-pretty encoding lokijs
```

3. Get API keys from [Alchemy](https://www.alchemy.com/) and [Wallet Connect](https://cloud.walletconnect.com/sign-up), then create an `.env.local` file at the root of the project

```bash
# ./.env.local

NEXT_PUBLIC_ALCHEMY_KEY="ALCHEMY_KEY"
NEXT_PUBLIC_WALLET_CONNECT_ID="WALLET_CONNECT_KEY"
```

4. Modify `next.config.js`

```javascript
// ./next.config.js

/** @type {import('next').NextConfig} */
module.exports = {
  reactStrictMode: true,
  webpack: (config) => {
    config.resolve.fallback = { fs: false, net: false, tls: false };
    return config;
  },
};
```

5. Create a Wagmi config

```typescript
// ./src/lib/wagmi.ts

import { getDefaultWallets } from "@rainbow-me/rainbowkit";
import { configureChains, createConfig } from "wagmi";
import { goerli, mainnet, polygon, polygonMumbai } from "wagmi/chains";
import { publicProvider } from "wagmi/providers/public";
import { alchemyProvider } from "wagmi/providers/alchemy";

const { chains, publicClient, webSocketPublicClient } = configureChains(
  [mainnet, polygon, goerli, polygonMumbai],
  [
    publicProvider(),
    alchemyProvider({ apiKey: process.env.NEXT_PUBLIC_ALCHEMY_API_KEY ?? "" }),
  ]
);

const { connectors } = getDefaultWallets({
  appName: "Aragon SDK Example App",
  chains,
  projectId: process.env.NEXT_PUBLIC_WALLET_CONNECT_ID ?? "",
});

const config = createConfig({
  autoConnect: true,
  connectors,
  publicClient,
  webSocketPublicClient,
});

export { config, chains };
```

6. Create a providers component

```typescript
// ./src/components/providers.tsx
"use client";

import React, { ReactNode, useEffect, useState } from "react";
import { chains, config } from "@/lib/wagmi";
import { RainbowKitProvider } from "@rainbow-me/rainbowkit";
import { WagmiConfig } from "wagmi";
import { AragonSDKWrapper } from "@/hooks/aragon";

interface ProvidersProps {
  children: ReactNode;
}

const Providers = ({ children }: ProvidersProps) => {
  const [mounted, setMounted] = useState(false);
  useEffect(() => setMounted(true), []);

  return (
    <WagmiConfig config={config}>
      <AragonSDKWrapper>
        <RainbowKitProvider chains={chains}>
          {mounted && children}
        </RainbowKitProvider>
      </AragonSDKWrapper>
    </WagmiConfig>
  );
};

export default Providers;
```

7. Wrap the layout component with the provider and import the rainbow kit styles

```typescript
// ./src/app/layout.tsx

import Providers from "@/components/providers";
import "./globals.css";
import type { Metadata } from "next";
import { Inter } from "next/font/google";

// import the styles from rainbow kit
import "@rainbow-me/rainbowkit/styles.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        // now all the pages and components can access Wagmi and Rainbow kit
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

8. Re-export the Rainbow kit `ConnectButton` as a client component

```typescript
// src/components/ConnectButton
"use client";
export { ConnectButton } from "@rainbow-me/rainbowkit";
```

9. Remove the code in the root `page.tsx` and replace it with:

```typescript
// ./src/app/page.tsx

import { ConnectButton } from "@/components/ConnectButton";

export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <ConnectButton />
    </main>
  );
}
```
